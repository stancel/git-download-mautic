---
# handlers file for git-download-mautic

- name: restart-apache
  service: 
    name: apache2 
    state: restarted

- name: "Clear-mautic-cache"
  become: true
  become_method: sudo
  shell: "rm -rf {{ web_files_path }}{{ web_directory_for_application }}/app/cache/*"
  listen: "finish-mautic-permissions"

- name: "Set ownership to Apache webuser"
  become: true
  become_method: sudo
  shell: "chown -R {{ web_user }}:{{ web_group }} {{ web_files_path }}{{ web_directory_for_application }}"
  listen: "finish-mautic-permissions"

- name: "Set ownership to root for Git files and directory"
  become: true
  become_method: sudo
  shell: "chown -R root:root {{ web_files_path }}{{ web_directory_for_application }}/.git {{ web_files_path }}{{ web_directory_for_application }}/.github {{ web_files_path }}{{ web_directory_for_application }}/.gitignore"
  listen: "finish-mautic-permissions"

- name: "Make Mautic Cache writable and executable"
  become: true
  become_method: sudo
  shell: "chmod -R 755 {{ web_files_path }}{{ web_directory_for_application }}/app/cache"
  listen: "finish-mautic-permissions"

- name: "Restart Apache for good measure"
  become: true
  become_method: sudo
  service: 
    name: apache2 
    state: restarted
  listen: "finish-mautic-permissions"


